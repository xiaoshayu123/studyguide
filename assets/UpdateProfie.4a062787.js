import{_ as S,d as j,r as R,a as l,b as c,f as s,J as _,g as m,w as p,E as b,k as f,u as $,l as q,c as g,j as P,v as I,x as D}from"./index.6f9a7cbe.js";import{U as M}from"./Uploader.ac001dde.js";import{a as T,V as z}from"./ValidateInput.58554200.js";const J=j({name:"UpdateProfile",components:{Uploader:M,ValidateForm:T,ValidateInput:z},setup(){let e=[{type:"required",message:"\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A"}];const a=f(!0),n=$(),v=q(),r=g(()=>n.getters.getColumnByid(v.params.id));let h=f(""),i=f("");P(()=>{n.dispatch("fetchCurrentColumn",v.params.id).then(u=>{h.value=u.title,i.value=u.description})});let o=g(()=>n.state.user),F=v.params.id,t=f(o.value.nickName),C=f(o.value.description);const V=I();let w=g(()=>o.value.avatar?o.value.avatar:new URL(""+new URL("pkq.7b8dade2.jpg",import.meta.url).href,self.location).href),B=g(()=>r.value&&r.value.avatar?r.value.avatar:new URL(""+new URL("pkq.7b8dade2.jpg",import.meta.url).href,self.location).href),d="";function A(){a.value=!0}function N(){a.value=!1}return{descriptionRef:C,nameRef:t,imgdata:w,checkto:a,clicktrue:A,clickfalse:N,columnNameRef:h,columnDesRef:i,imgdata2:B,updateUser:u=>{if(u){const U=t.value,E=C.value,y=d!==""?d:o.value.avatar,k={...o.value,nickName:U,description:E,avatar:y};n.dispatch("patchCurrentUser",k).then(L=>{D("\u4FEE\u6539\u6210\u529F\uFF0C2\u79D2\u540E\u8DF3\u56DE\u5230\u9996\u9875","success"),setTimeout(()=>{V.push({name:"home"})},2e3)})}},handleFileUpdated:u=>{u.url&&(d=u.url)},updateColumn:u=>{if(u){const U=h.value,E=i.value;console.log(d),console.log(r.value);const y=d!==""?d:r.value.avatar,k={title:U,description:E,avatar:y,_id:F};console.log(k),n.dispatch("patchCurrentColumn",k).then(L=>{D("\u4FEE\u6539\u6210\u529F\uFF0C2\u79D2\u540E\u8DF3\u56DE\u5230\u9996\u9875","success"),setTimeout(()=>{V.push({name:"home"})},2e3)})}},passwordrules:e}}}),G={class:"w-690"},H={class:"nav nav-tabs my-4"},K={key:0},O={key:1},Q=["src"],W=["src"],X=s("div",{class:"spinner-border text-secondary",role:"status"},[s("span",{class:"visually-hidden"},"Loading...")],-1),Y=s("h2",null,"\u6B63\u5728\u4E0A\u4F20",-1),Z=["src"],x={class:"mb-3"},ee={class:"mb-3"},ae={class:"mb-3"},te={class:"mb-3"};function se(e,a,n,v,r,h){const i=R("uploader"),o=R("validate-input"),F=R("validate-form");return l(),c("div",G,[s("ul",H,[s("li",{class:"nav-item",onClick:a[0]||(a[0]=(...t)=>e.clicktrue&&e.clicktrue(...t))},[s("a",{href:"#",class:_([{active:e.checkto},"nav-link"])},"\u66F4\u65B0\u4E2A\u4EBA\u8D44\u6599",2)]),s("li",{onClick:a[1]||(a[1]=(...t)=>e.clickfalse&&e.clickfalse(...t))},[s("a",{href:"#",class:_([{active:!e.checkto},"nav-link"])},"\u66F4\u65B0\u4E13\u680F\u4FE1\u606F",2)])]),e.checkto?(l(),c("h4",K,"\u7F16\u8F91\u4E2A\u4EBA\u8D44\u6599")):(l(),c("h4",O,"\u7F16\u8F91\u4E13\u680F\u4FE1\u606F")),m(i,{action:"/upload/img",onFileUploaded:e.handleFileUpdated,class:"uploader-container d-flex align-items-center justify-content-center bg-light text-secondary w-100 my-4"},{loading:p(()=>[X,Y]),uploaded:p(t=>[s("img",{src:t.uploadedData},null,8,Z)]),default:p(()=>[e.checkto?(l(),c("img",{key:0,src:e.imgdata},null,8,Q)):(l(),c("img",{key:1,src:e.imgdata2,alt:""},null,8,W))]),_:1},8,["onFileUploaded"]),e.checkto?(l(),b(F,{key:2,onFormSubmit:e.updateUser},{default:p(()=>[s("div",x,[m(o,{rules:e.passwordrules,modelValue:e.nameRef,"onUpdate:modelValue":a[2]||(a[2]=t=>e.nameRef=t),type:"text"},null,8,["rules","modelValue"])]),s("div",ee,[m(o,{rules:e.passwordrules,modelValue:e.descriptionRef,"onUpdate:modelValue":a[3]||(a[3]=t=>e.descriptionRef=t),tag:"textarea"},null,8,["rules","modelValue"])])]),_:1},8,["onFormSubmit"])):(l(),b(F,{key:3,onFormSubmit:e.updateColumn},{default:p(()=>[s("div",ae,[m(o,{rules:e.passwordrules,modelValue:e.columnNameRef,"onUpdate:modelValue":a[4]||(a[4]=t=>e.columnNameRef=t),type:"text"},null,8,["rules","modelValue"])]),s("div",te,[m(o,{rules:e.passwordrules,modelValue:e.columnDesRef,"onUpdate:modelValue":a[5]||(a[5]=t=>e.columnDesRef=t),tag:"textarea"},null,8,["rules","modelValue"])])]),_:1},8,["onFormSubmit"]))])}const ie=S(J,[["render",se]]);export{ie as default};
